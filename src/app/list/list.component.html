<xont-ventura-message-prompt #msgPrompt></xont-ventura-message-prompt>

<!-- Loading Overlay -->
<div *ngIf="isLoading" class="loading-overlay">
  <div class="loading-spinner">
    <span>Loading...</span>
  </div>
</div>

<!-- Collapsible Section -->
<xont-ventura-collapsible
  id="collapse1"
  targetElementID="selectionCriteria"
  [collapsed]="searchForm.get('Collapsed')?.value"
  (onChange)="toggleCollapse()"
></xont-ventura-collapsible>

<form
  [formGroup]="searchForm"
  (ngSubmit)="list(true)"
  [hidden]="searchForm.get('Collapsed')?.value"
>
  <div id="selectionCriteria" class="collapse">
    <div class="form-section">
      <div class="form-row">
        <label for="txtExecutiveCode" class="form-label">Executive Code</label>
        <input
          formControlName="ExecutiveCode"
          type="text"
          id="txtExecutiveCode"
          class="form-input"
          maxlength="10"
        />
      </div>

      <div class="form-row">
        <label for="txtExecutiveName" class="form-label">Executive Name</label>
        <input
          formControlName="ExecutiveName"
          type="text"
          id="txtExecutiveName"
          class="form-input"
          maxlength="50"
        />
      </div>

      <div class="form-row" formGroupName="Territory">
        <label class="form-label">Territory</label>
        <xont-ventura-list-prompt
          name="lpmtTerritory"
          id="lpmtTerritory"
          #lpmtTerritory
          [maxLengths]="[4, 50]"
          [inputWidths]="[120, 320]"
          [gridHeaders]="['Territory Code', 'Description']"
          [gridFields]="['masterGroupValue', 'masterGroupValueDescription']"
          [mandatory]="false"
          [type]="'Territory'"
          [control]="searchForm"
          [status]="'All'"
          [strict]="true"
          [modelProps]="['territoryCode', 'territoryDesc']"
          [dataFields]="['masterGroupValue', 'masterGroupValueDescription']"
        >
        </xont-ventura-list-prompt>
      </div>

      <div class="form-row" formGroupName="OperationTypeGroup">
        <label class="form-label">Operation Type</label>
        <xont-ventura-list-prompt
          name="lpmtOptType"
          id="lpmtOptType"
          #lpmtOptType
          [maxLengths]="[2, 50]"
          [inputWidths]="[120, 320]"
          [gridHeaders]="['Code', 'Description']"
          [gridFields]="['code', 'description']"
          [mandatory]="false"
          [strict]="true"
          [control]="searchForm"
          (onDataBind)="lpmtOptType_DataBind()"
          [modelProps]="['operationType', 'operationTypeDesc']"
          [dataFields]="['code', 'description']"
        >
        </xont-ventura-list-prompt>
      </div>

      <xont-ventura-classification-selector
        #clsExecutive
        [id]="cls1.ID"
        [taskCode]="cls1.TaskCode"
        [classificationType]="cls1.Type"
        [labelWidth]="cls1.LabelWidth"
        [enableUserInput]="cls1.EnableUserInput"
        [codeTextWidth]="cls1.CodeTextWidth"
        [descriptionTextWidth]="cls1.DescriptionTextWidth"
        [activeStatus]="cls1.ActiveStatus"
        [allMandatory]="cls1.AllMandatory"
        [lastLevelRequired]="cls1.LastLevelRequired"
      >
      </xont-ventura-classification-selector>

      <div class="form-row">
        <label class="form-label">Search type</label>
        <div class="radio-group">
          <label class="radio-option">
            <input
              type="radio"
              formControlName="SearchType"
              value="startWith"
              id="optStartWith"
            />
            <span>Start with</span>
          </label>
          <label class="radio-option">
            <input
              type="radio"
              formControlName="SearchType"
              value="anyWhere"
              id="optAnyWhereInText"
            />
            <span>Anywhere in text</span>
          </label>
        </div>
      </div>

      <div class="form-row checkbox-row">
        <label class="checkbox-container">
          <input
            type="checkbox"
            formControlName="ActiveOnly"
            id="chkActiveOnly"
          />
          <span class="checkmark"></span>
          <span>Active only</span>
        </label>
      </div>

      <div class="form-row button-row">
        <button type="submit" id="btnList" class="main-button">List</button>
      </div>
    </div>
  </div>
</form>

<!-- Results Section -->
<div class="results-section">
  <div *ngIf="!isLoading && executiveDataset?.length === 0" class="no-data">
    No data found for the given criteria
  </div>

  <div
    class="data-table-container"
    *ngIf="executiveDataset && executiveDataset.length > 0"
  >
    <table class="data-table">
      <thead>
        <tr>
          <th>Executive Code</th>
          <th>Executive Name</th>
          <th>User Profile</th>
          <th>Territory</th>
          <th>Operation Type</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let item of executiveDataset; trackBy: trackByExecutive"
          [class.deactive-row]="item.Status === 0"
        >
          <td>{{ item.ExecutiveCode }}</td>
          <td>{{ item.ExecutiveName }}</td>
          <td>{{ item.UserProfileName }}</td>
          <td>{{ item.TerritoryName }}</td>
          <td>{{ item.OperationTypeDesc }}</td>
          <td class="actions-cell">
            <button
              class="action-button"
              (click)="newBasedOn_OnClick(item)"
              title="New Based On"
            >
              Clone
            </button>
            <button
              class="action-button edit-button"
              (click)="edit_OnClick(item)"
              title="Edit"
            >
              Edit
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div
    class="pagination-container"
    *ngIf="executiveDataset && executiveDataset.length > 0"
  >
    <span style="float: right">
      <xont-ventura-gridloader
        #gridLoader
        (onChange)="gridLoader_OnChange()"
      ></xont-ventura-gridloader>
    </span>
  </div>
</div>

<!-- Action Buttons -->
<div class="action-buttons">
  <button (click)="btnNew_OnClick()" id="btnNew" class="main-button">
    New
  </button>
  <button onclick="closeTab()" class="main-button secondary-button">
    Exit
  </button>
</div>
